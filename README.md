
# TCPλ¥Ό μ΄μ©ν• μ›κ²© μ¥μΉ μ μ–΄ μ‹μ¤ν…

Raspberry Pi μ„λ²„μ™€ Ubuntu ν΄λΌμ΄μ–ΈνΈ κ°„ TCP ν†µμ‹ μ„ ν†µν•΄ LED, λ¶€μ €, μ΅°λ„μ„Όμ„, 7μ„Έκ·Έλ¨ΌνΈλ¥Ό μ μ–΄ν•λ” μ›κ²© μ μ–΄ μ‹μ¤ν…μ…λ‹λ‹¤.
μ¥μΉ μ μ–΄ μ½”λ“λ” λ¨λ“λ³„ κ³µμ  λΌμ΄λΈλ¬λ¦¬(`.so`)λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.
λ°λ¬ ν•νƒλ΅ μ‹¤ν–‰λλ” μ„λ²„μ™€ λ…λ Ήμ–΄λ¥Ό μ „λ‹¬ν•λ” ν΄λΌμ΄μ–ΈνΈ κµ¬μ΅°λ΅ κµ¬μ„±λμ–΄ μμµλ‹λ‹¤.

## π› οΈ ν”„λ΅μ νΈ κ°μ”

* **λ©ν‘**: μ΅°λ„ μ„Όμ„λ¥Ό ν†µν•΄ μ£Όλ³€ λ°κΈ°λ¥Ό κ°μ§€ν•κ³ , ν΄λΌμ΄μ–ΈνΈ λ…λ Ή λλ” μ„Όμ„ μ΅°κ±΄μ— λ”°λΌ λ‹¤μ–‘ν• μ¥μΉλ¥Ό μ μ–΄ν•©λ‹λ‹¤.
* **μ„λ²„**: Raspberry Pi (TCP μ„λ²„ + λ°λ¬ ν”„λ΅μ„Έμ¤)
* **ν΄λΌμ΄μ–ΈνΈ**: Ubuntu (TCP ν΄λΌμ΄μ–ΈνΈ)
* **μ μ–΄ μ¥μΉ**: LED, λ¶€μ €, μ΅°λ„ μ„Όμ„, 7μ„Έκ·Έλ¨ΌνΈ
* **κµ¬μ„± λ°©μ‹**: κ° μ¥μΉλ¥Ό `.so` ν•νƒμ λ™μ  λΌμ΄λΈλ¬λ¦¬λ΅ λ¶„λ¦¬ν•κ³ , μ„λ²„μ—μ„ `dlopen` λ°©μ‹μΌλ΅ μ μ–΄


## π’» μ‚¬μ© κΈ°μ  λ° ν™κ²½

* **OS**: Raspberry Pi OS (Server), Ubuntu (Client)
* **μ–Έμ–΄**: C
* **λΌμ΄λΈλ¬λ¦¬**:

  * WiringPi
  * POSIX Thread
  * systemd (λ°λ¬)
  * `dlopen` (λ™μ  λ΅λ”©)
* **ν†µμ‹  λ°©μ‹**: TCP IPv4
* **μ μ–΄ λ°©μ‹**: κ° μ¥μΉλ³„ κ³µμ  λΌμ΄λΈλ¬λ¦¬ (`.so`) λ΅λ“ λ° μ‹¤ν–‰
* **μ‹¤ν–‰ κµ¬μ΅°**:

  * λ°λ¬ (Server)
  * CLI (Client)

## π”§ ν•λ“μ›¨μ–΄ κµ¬μ„± μμ‹
μ•„λ μ‚¬μ§„μ€ Raspberry Piμ™€ μ„Όμ„ λ° μ μ–΄ μ¥μΉκ°€ μ‹¤μ λ΅ μ—°κ²°λ κµ¬μ„±μ…λ‹λ‹¤.
![circuit](https://github.com/user-attachments/assets/bb7ad799-9d7d-4da6-a183-1493dd44fec3)


## π“ λ””λ ‰ν† λ¦¬ λ° νμΌ κµ¬μ΅°

```
project/
β”β”€β”€ Makefile
β”β”€β”€ 7segment/
β”‚   β”β”€β”€ 7segment.c
β”‚   β”β”€β”€ 7segment.h
β”‚   β””β”€β”€ 7segment.so
β”β”€β”€ buzzer/
β”‚   β”β”€β”€ buzzer.c
β”‚   β”β”€β”€ buzzer.h
β”‚   β””β”€β”€ buzzer.so
β”β”€β”€ led/
β”‚   β”β”€β”€ led.c
β”‚   β”β”€β”€ led.h
β”‚   β””β”€β”€ led.so
β”β”€β”€ light/
β”‚   β”β”€β”€ light.c
β”‚   β”β”€β”€ light.h
β”‚   β””β”€β”€ light.so
β”β”€β”€ server/
β”‚   β”β”€β”€ server3.c
β”‚   β””β”€β”€ server3
```


---

### π  Ubuntu (`client/`)

> Ubuntu ν™κ²½μ—μ„ μ„λ²„μ— μ ‘μ†ν•κ³  λ…λ Ήμ–΄λ¥Ό μ „μ†΅ν•λ” TCP ν΄λΌμ΄μ–ΈνΈ ν”„λ΅κ·Έλ¨ λ””λ ‰ν† λ¦¬

```plaintext
client/
β”β”€β”€ Makefile
β””β”€β”€ client.c
```

---

## β™οΈ μ„λ²„ (Raspberry Pi) λΉλ“ λ° μ‹¤ν–‰ λ°©λ²•

### 1οΈβƒ£ ν”„λ΅μ νΈ λΉλ“

```bash
cd ~/project         # ν”„λ΅μ νΈ λ””λ ‰ν† λ¦¬λ΅ μ΄λ™
make clean           # μ „μ²΄ λ¨λ“ λ° μ„λ²„ μ •λ¦¬
make                 # μ „μ²΄ λ¨λ“ λ° μ„λ²„ μ»΄νμΌ
```

> λΉλ“ μ™„λ£ ν›„ `server/server3` μ‹¤ν–‰ νμΌκ³Ό κ° λ¨λ“μ `.so` νμΌμ΄ μƒμ„±λ©λ‹λ‹¤.


### 2οΈβƒ£ μ„λ²„ μ‹¤ν–‰ νμΌ λ° μ„λΉ„μ¤ λ“±λ΅

```bash
# μ‹¤ν–‰ νμΌ λ³µμ‚¬
sudo cp server/server3 /usr/local/bin/

# systemd μ„λΉ„μ¤ νμΌ λ³µμ‚¬
sudo cp server/server3.service /etc/systemd/system/

# systemd μ„λΉ„μ¤ μ¬λ΅λ“
sudo systemctl daemon-reexec
```


### 3οΈ μ„λ²„ λ°λ¬ λ“±λ΅ λ° μ‹¤ν–‰

```bash
# λ¶€ν… μ‹ μλ™ μ‹¤ν–‰ μ„¤μ •
sudo systemctl enable server3.service

# μ¦‰μ‹ μ„λ²„ μ‹¤ν–‰
sudo systemctl start server3.service
```


### 4οΈβƒ£ μ„λ²„ μƒνƒ λ° λ΅κ·Έ ν™•μΈ

#### 1. μ„λ²„ μƒνƒ ν™•μΈ

```bash
sudo systemctl status server3.service
```

> μ •μƒ λ™μ‘ μ¤‘μΌ κ²½μ° `Active: active (running)`μΌλ΅ ν‘μ‹λ©λ‹λ‹¤.

#### 2. μ„λ²„μ—μ„ λ΅κ·Έ ν™•μΈ

```bash
tail -n 30 /tmp/server_action.log
```

> ν΄λΌμ΄μ–ΈνΈ μ—°κ²°, λ…λ Ή μ²λ¦¬, μ„Όμ„ κ°μ§€ λ“± λ¨λ“  ν™λ™ κΈ°λ΅μ΄ μ €μ¥λ©λ‹λ‹¤.


### 5οΈβƒ£ μ„λ²„ μ μ–΄ λ…λ Ή (ν•„μ” μ‹)

```bash
# μ„λ²„ μ¬μ‹μ‘
sudo systemctl restart server3.service

# μ„λ²„ μ¤‘μ§€
sudo systemctl stop server3.service
```

### π“ μ„λ²„ μ£Όμ” κΈ°λ¥

* ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ…λ Ή μμ‹  (`LED_ON`, `BUZZER_OFF`, λ“±)
* μ΅°λ„ μ„Όμ„ μƒνƒμ— λ”°λ¥Έ μλ™ LED μ μ–΄
* μμ•½ λ…λ Ήμ–΄ μ‹¤ν–‰ (`SCHEDULE LED_ON AFTER 3`)
* λ¨λ“  λ™μ‘ `/tmp/server_action.log`μ— κΈ°λ΅
* systemd λ°λ¬ ν•νƒλ΅ λ°±κ·ΈλΌμ΄λ“ μ‹¤ν–‰

---

## π’» ν΄λΌμ΄μ–ΈνΈ (Ubuntu) λΉλ“ λ° μ‹¤ν–‰ λ°©λ²•

### 1οΈβƒ£ ν΄λΌμ΄μ–ΈνΈ λ””λ ‰ν† λ¦¬λ΅ μ΄λ™

```bash
cd ~/client
```

### 2οΈβƒ£ λΉλ“

```bash
make
```

> `Makefile`μ„ μ΄μ©ν•΄ `client.c`κ°€ μ»΄νμΌλκ³  μ‹¤ν–‰ νμΌ `client`κ°€ μƒμ„±λ©λ‹λ‹¤.

### 3οΈβƒ£ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰

```bash
./client <μ„λ²„_IPμ£Όμ†> <ν¬νΈλ²νΈ>
```

μμ‹:

```bash
./client 192.168.0.10 12345
```

> Raspberry Piμ—μ„ μ‹¤ν–‰ μ¤‘μΈ μ„λ²„μ— TCPλ΅ μ—°κ²°λ©λ‹λ‹¤.

---

### π“‹ μ‚¬μ© κ°€λ¥ν• λ…λ Ήμ–΄

| λ…λ Ήμ–΄                              | μ„¤λ…                                      |
| -------------------------------- | --------------------------------------- |
| `LED_ON`, `LED_OFF`              | LED μΌκΈ°/λ„κΈ°                               |
| `LED_HIGH`, `LED_MID`, `LED_LOW` | LED λ°κΈ° λ‹¨κ³„ μ΅°μ                             |
| `BUZZER_ON`, `BUZZER_OFF`        | λ¶€μ € μΌκΈ°/λ„κΈ°                                |
| `LIGHT`                          | μ΅°λ„ μ„Όμ„ μƒνƒ ν™•μΈ λ° LED μλ™ μ μ–΄                 |
| `0`\~`9`                         | μ…λ ¥ν• μ«μλ¶€ν„° μΉ΄μ΄νΈλ‹¤μ΄                          |
| `SCHEDULE <CMD> AFTER <μ΄>`       | λ…λ Ή μμ•½ μ‹¤ν–‰ (`μ: SCHEDULE LED_ON AFTER 3`) |
| `exit`                           | ν΄λΌμ΄μ–ΈνΈ μΆ…λ£                                |

---

### π“ μμ‹

```bash
cmd> LED_ON
resp: OK

cmd> SCHEDULE BUZZER_ON AFTER 5
resp: SCHEDULED
```

---

### π” μ•μ „ μΆ…λ£

```bash
exit OR Ctrl + C
```

> μΈν„°λ½νΈ μ‹ μλ™μΌλ΅ μ„λ²„μ™€μ μ†μΌ“μ„ λ‹«κ³  μΆ…λ£ λ©”μ‹μ§€λ¥Ό μ¶λ ¥ν•©λ‹λ‹¤.

---

μ„ λ‚΄μ©μ„ `README.md`μ— κ·Έλ€λ΅ λ¶™μ—¬ λ„£μΌλ©΄ μΌκ΄€μ„± μλ” ν΄λΌμ΄μ–ΈνΈ μ„Ήμ…μ΄ μ™„μ„±λ©λ‹λ‹¤.
λ‹¤μμΌλ΅ ν•„μ”ν•μ‹  λ‚΄μ©μ€ `λ…λ Ήμ–΄ ν”„λ΅ν† μ½ μ •λ¦¬`, `λ¬Έμ„ μ μ¶μ© μ••μ¶• κµ¬μ„±`, λλ” `.md` μ™„μ„±λ³Έ λ‚΄λ³΄λ‚΄κΈ° λ“± λ„μ™€λ“λ¦΄ μ μμ–΄μ”.


## π’» ν΄λΌμ΄μ–ΈνΈ(Ubuntu) λΉλ“ λ° μ‹¤ν–‰ λ°©λ²•

```bash
cd client
make
./client <λΌμ¦λ² λ¦¬νμ΄_IPμ£Όμ†> <ν¬νΈ>
```

μμ‹:

```bash
./client 192.168.0.10 12345:
```

## β  λ¬Έμ μ  λ° ν–¥ν›„ κ°μ„  λ°©ν–¥

* ν΄λΌμ΄μ–ΈνΈ λ…λ Ήμ–΄ λ°©μ‹μ΄ ν…μ¤νΈ κΈ°λ°μ΄λΌ μ‚¬μ©μ μΉν™”μ„±μ΄ λ‚®μ

* μμ™Έ μƒν™© μ²λ¦¬ λ¶€μ΅±

* μ„¤μ • κ°’(μ: μ΅°λ„μ„Όμ„ μ„κ³„κ°’ λ“±)μ΄ μ½”λ“μ— κ³ μ •λμ–΄ μμ–΄ μ μ§€λ³΄μ λ¶νΈ

## β€» ν–¥ν›„ κ°μ„  λ°©ν–¥
* μ¤λ λ“ ν’€(Thread Pool) λλ” μ΄λ²¤νΈ κΈ°λ° μ²λ¦¬(epoll λ“±) κµ¬μ΅°λ΅ κ°μ„ ν•μ—¬ λ¦¬μ†μ¤ ν¨μ¨ ν–¥μƒ

* GUI ν΄λΌμ΄μ–ΈνΈ λλ” μ›Ή λ€μ‹λ³΄λ“ κµ¬ν„μΌλ΅ μ‚¬μ© νΈμμ„± κ°•ν™”

* μ„Όμ„ μƒνƒμ μ‹¤μ‹κ°„ ν”Όλ“λ°± μ „μ†΅ κµ¬ν„ (ν΄λΌμ΄μ–ΈνΈμ— push λ°©μ‹μΌλ΅ μ•λ¦Ό)

* μ„¤μ • νμΌ κΈ°λ° μ‹μ¤ν… κµ¬μ„± (.conf νμΌ λ“±μΌλ΅ μ„κ³„κ°’, ν¬νΈ λ“± μ™Έλ¶€ μ„¤μ •ν™”)

* μ—λ¬ λ° μμ™Έ μ²λ¦¬ κ°•ν™” (λ…λ Ήμ–΄ μ ν¨μ„± κ²€μ‚¬, μ¥μΉ μ‹¤ν¨ λ΅κΉ… λ“±)


